<!-- src/index.html -->
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil - Mon Site de Streaming</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body class="dark-mode">
    <div class="background"></div>
    <div class="sidebar">
        <div class="hamburger">‚ò∞</div>
        <div class="logo">
            <img src="logo.png" alt="Logo">
        </div>
        <h2>Genres</h2>
        <ul>
            <li><a href="#" class="active"><i class="fas fa-globe"></i> Tous</a></li>
            <li><a href="#" class="popular"><i class="fas fa-gamepad"></i> Jeux Vid√©o</a></li>
            <li><a href="#"><i class="fas fa-futbol"></i> Sport</a></li>
            <li><a href="#" class="popular"><i class="fas fa-comment"></i> Chatting</a></li>
            <li><a href="#"><i class="fas fa-music"></i> Musique</a></li>
            <li><a href="#"><i class="fas fa-utensils"></i> Cuisine</a></li>
            <li><a href="#"><i class="fas fa-paint-brush"></i> Art</a></li>
        </ul>
        <h2>Navigation</h2>
        <ul>
            <li id="profileLink"><a href="profile.html"><i class="fas fa-user"></i> Profil</a></li>
            <li id="loginLink"><a href="login.html"><i class="fas fa-sign-in-alt"></i> Connexion</a></li>
            <li id="logoutLink" style="display: none;"><a href="#" onclick="logout()"><i
                        class="fas fa-sign-out-alt"></i> D√©connexion</a></li>
        </ul>
    </div>
    <div class="main-content">
        <header>
            <div class="search-bar">
                <input type="text" placeholder="Rechercher un stream...">
                <button>üîç</button>
            </div>
            <h1>Bienvenue sur [Nom du Site]</h1>
            <p>D√©couvrez les meilleurs streams en direct !</p>
            <div class="filters">
                <button class="filter-btn active">En direct</button>
                <button class="filter-btn">Populaire</button>
                <button class="filter-btn">Nouveaux</button>
            </div>
            <button class="theme-toggle">‚òÄÔ∏è Mode Clair</button>
        </header>
        <div style="text-align: center; margin: 50px 0;">
            <a href="startstream.html" style="text-decoration: none;">
                <button
                    style="padding: 15px 30px; font-size: 18px; background-color: #ff4500; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Commencer le stream
                </button>
            </a>
        </div>
        <section class="stream-grid" id="activeStreams">
            <h2>Streams en direct</h2>
            <!-- Les streams seront ins√©r√©s ici par JavaScript -->
        </section>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        async function checkLoginStatus() {
            const response = await fetch('/api/profile', { credentials: 'include' });
            const profileLink = document.getElementById('profileLink');
            const loginLink = document.getElementById('loginLink');
            const logoutLink = document.getElementById('logoutLink');

            if (response.ok) {
                loginLink.style.display = 'none';
                profileLink.style.display = 'block';
                logoutLink.style.display = 'block';
            } else {
                profileLink.style.display = 'none';
                loginLink.style.display = 'block';
                logoutLink.style.display = 'none';
            }
        }

        async function logout() {
            await fetch('/api/logout', { credentials: 'include' });
            window.location.href = '/login.html';
        }

        async function loadActiveStreams() {
            const response = await fetch('/api/active-streams');
            const streams = await response.json();
            const streamGrid = document.getElementById('activeStreams');

            streamGrid.innerHTML = '<h2>Streams en direct</h2>';
            streams.forEach(stream => {
                const card = document.createElement('div');
                card.className = 'stream-card';
                card.innerHTML = `
                    <div class="thumbnail"><span class="live-badge">LIVE</span></div>
                    <h3>${stream.title}</h3>
                    <p>Streamer: <a href="profile.html">${stream.username}</a> | <span class="viewer-count">${stream.viewers}</span> spectateurs</p>
                    <button onclick="watchStream('${stream.streamId}')">Regarder</button>
                    <button onclick="subscribeTo('${stream.username}')"><i class="fas fa-user-plus"></i> S'abonner</button>
                    <button onclick="likeStream('${stream.streamId}')"><i class="fas fa-heart"></i> Aimer</button>
                `;
                streamGrid.appendChild(card);
            });
        }

        async function watchStream(streamId) {
            window.location.href = `/stream.html?streamId=${streamId}`;
        }

        async function subscribeTo(streamer) {
            const response = await fetch('/api/subscribe', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ streamer }),
                credentials: 'include',
            });
            const data = await response.json();
            alert(data.message);
        }

        async function likeStream(streamId) {
            const response = await fetch('/api/like-stream', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ streamId }),
                credentials: 'include',
            });
            const data = await response.json();
            alert(data.message);
        }

        checkLoginStatus();
        loadActiveStreams();
        socket.on('new-stream', loadActiveStreams);

        document.querySelector('.hamburger').addEventListener('click', () => {
            document.querySelector('.sidebar').classList.toggle('collapsed');
        });

        document.querySelector('.theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
            const btn = document.querySelector('.theme-toggle');
            btn.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Mode Clair' : 'üåô Mode Sombre';
        });
    </script>
</body>

</html>